---
- name: Setup openvswitch network on master
  command: "{{ item }}"
  with_items:
  - ovs-vsctl add-br br-int
  - ip link add veth0 type veth peer name veth1
  - ovs-vsctl add-port br-int veth1
  - brctl addif docker0 veth0
  - ip link set veth1 up
  - ip link set veth0 up

- name: Setup GRE tunnel from this host to nodes
  command: ovs-vsctl add-port br-int gre{{ hostvars[item]["node_id"] }} -- set interface gre{{ hostvars[item]["node_id"] }} type=gre options:remote_ip={{ hostvars[item]["node_ip"] }}
  with_items: "{{ groups['nodes'] }}"
